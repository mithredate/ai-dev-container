{
  "project": "AI Dev Container",
  "branchName": "ralph/claude-brain-sidecar-v2",
  "description": "Claude Brain Sidecar v2 - Overhaul Docker image with auto-start Claude entrypoint, YOLO mode support, and Go-based bridge for sidecar container command execution",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create entrypoint wrapper script",
      "description": "As a user, I want the container to start Claude automatically so that I don't have to manually run it after entering the container.",
      "acceptanceCriteria": [
        "Create /scripts/entrypoint.sh wrapper script",
        "Script runs 'claude' by default when container starts",
        "Script is executable (chmod +x)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement YOLO mode in entrypoint",
      "description": "As a power user, I want to run Claude with minimal confirmation prompts so that I can automate workflows in isolated environments.",
      "acceptanceCriteria": [
        "When CLAUDE_YOLO=1 is set, entrypoint runs 'claude --dangerously-skip-permissions'",
        "When CLAUDE_YOLO is unset or '0', entrypoint runs 'claude' (safe mode)",
        "Entrypoint script logs which mode is being used to stderr",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Initialize Go module for bridge",
      "description": "As a developer, I need a Go module structure so that I can build the bridge binary.",
      "acceptanceCriteria": [
        "Create /cmd/bridge/main.go with basic CLI skeleton",
        "Create /go.mod with module path github.com/mithredate/ai-dev-container",
        "Add dependency on gopkg.in/yaml.v3 for config parsing",
        "'go build ./cmd/bridge' compiles successfully",
        "Binary shows help text when run with --help",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Implement config parsing in Go bridge",
      "description": "As a user, I want the Go bridge to read my bridge.yaml configuration so that commands route to the correct containers.",
      "acceptanceCriteria": [
        "Bridge reads config from /workspace/.claude/bridge.yaml by default",
        "Bridge supports BRIDGE_CONFIG env var to override config path",
        "Config schema supports: version, default_container, containers, commands",
        "Invalid YAML produces clear error message with line number",
        "Missing required fields produce specific error messages",
        "Missing config file produces error with example config path",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement path mapping in Go bridge",
      "description": "As a user, I want the bridge to translate file paths between Claude's workspace and container working directories so that file references work correctly.",
      "acceptanceCriteria": [
        "Config schema supports 'paths' section for path mappings",
        "Path translation applied to command arguments containing mapped prefixes",
        "Path translation is optional (works without 'paths' section)",
        "Multiple path mappings supported per container",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement command routing in Go bridge",
      "description": "As a user, I want the bridge to execute commands in the correct sidecar container based on my configuration.",
      "acceptanceCriteria": [
        "'bridge <command> [args...]' executes command in configured container",
        "Uses 'docker exec' to run commands in target container",
        "Supports 'workdir' option to set working directory in container",
        "Supports 'exec' option to map command alias to actual command",
        "Unrecognized commands use 'default_container' if configured",
        "Unrecognized commands without default produce clear error",
        "Container name resolution uses 'containers' section overrides",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Implement real-time output streaming",
      "description": "As a user, I want to see command output in real-time so that I can monitor long-running operations like test suites or package installations.",
      "acceptanceCriteria": [
        "stdout from docker exec streams to bridge stdout in real-time",
        "stderr from docker exec streams to bridge stderr in real-time",
        "No buffering of output (visible as commands produce it)",
        "TTY allocated when bridge is run in a terminal (for colored output)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement exit code propagation",
      "description": "As a user, I want the bridge to return the same exit code as the remote command so that scripts can detect failures.",
      "acceptanceCriteria": [
        "Bridge exits with same code as the docker exec command",
        "Exit code 0 when command succeeds",
        "Non-zero exit code when command fails",
        "Exit code 1 when bridge itself fails (config error, docker error)",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Update Dockerfile for Go multi-stage build",
      "description": "As a developer, I need the Dockerfile to compile the Go bridge and include it in the final image.",
      "acceptanceCriteria": [
        "Add Go builder stage using golang:1.22-alpine",
        "Compile bridge with CGO_ENABLED=0 for static binary",
        "Copy bridge binary to /usr/local/bin/bridge in runtime stage",
        "Remove yq binary and wget from builder stage",
        "Remove /scripts/bridge shell script if it exists",
        "Dockerfile uses ENTRYPOINT [\"/scripts/entrypoint.sh\"]",
        "Remove CMD [\"sh\"] from Dockerfile",
        "'docker build' completes successfully",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Verify image size under 150MB",
      "description": "As a developer, I want to ensure the final image size remains under 150MB.",
      "acceptanceCriteria": [
        "Build the Docker image successfully",
        "Verify image size is under 150MB using 'docker images'",
        "Verify yq is not present in final image",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Update examples with path mapping",
      "description": "As a user reading the documentation, I want to see how to configure path mapping so that I can set it up for my project.",
      "acceptanceCriteria": [
        "Update examples/claude-bridge.yaml with 'paths' section example",
        "Show mapping from /workspace to container-specific paths",
        "Include comments explaining when path mapping is needed",
        "Example demonstrates PHP container with /var/www/html mapping",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Update documentation",
      "description": "As a user, I want updated documentation reflecting the new entrypoint and Go bridge so that I can use the image correctly.",
      "acceptanceCriteria": [
        "Update README.md with new 'docker run' usage (no manual claude start)",
        "Document YOLO mode with security warnings",
        "Update bridge configuration docs for path mapping feature",
        "Remove references to yq dependency",
        "Update 'Building the Image' section to mention Go compilation",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    }
  ]
}
