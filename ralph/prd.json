{
  "project": "AI Dev Container",
  "branchName": "ralph/ghcr-github-actions",
  "description": "Push Container to GitHub Container Registry via GitHub Actions - automate building and publishing Docker container to GHCR with multi-platform support, semantic versioning, and security scanning",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create GitHub Actions workflow file",
      "description": "As a developer, I need a GitHub Actions workflow file that triggers on the correct events so that container builds happen automatically.",
      "acceptanceCriteria": [
        "Create .github/workflows/docker-publish.yml workflow file",
        "Workflow triggers on push to main branch",
        "Workflow triggers on push of version tags matching v*.*.* pattern",
        "Workflow triggers on workflow_dispatch for manual runs",
        "Workflow has appropriate name and job names for clarity",
        "Workflow YAML syntax is valid (validated with yq or similar)"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Configure GHCR authentication",
      "description": "As a developer, I need the workflow to authenticate with GHCR so that it can push images to the registry.",
      "acceptanceCriteria": [
        "Workflow uses GITHUB_TOKEN for authentication (no manual secrets needed)",
        "Login step uses docker/login-action with ghcr.io registry",
        "Permissions are set correctly (contents: read, packages: write)",
        "Image is pushed to ghcr.io/${{ github.repository }} namespace",
        "Workflow YAML syntax is valid"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Implement image tagging strategy",
      "description": "As a developer, I want images tagged with multiple identifiers so that I can reference specific versions or always get the latest.",
      "acceptanceCriteria": [
        "Use docker/metadata-action to generate tags",
        "Push to main produces :latest tag",
        "Push to main produces :sha-<short-sha> tag (e.g., sha-abc1234)",
        "Push of v1.2.3 tag produces :1.2.3, :1.2, and :1 tags",
        "Push of v1.2.3 tag also produces :sha-<short-sha> tag",
        "All images include OCI labels (created date, revision, description)",
        "Workflow YAML syntax is valid"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Update Dockerfile for multi-arch compatibility",
      "description": "As a developer, I need the Dockerfile to support multi-architecture builds so that the same Dockerfile works for both AMD64 and ARM64.",
      "acceptanceCriteria": [
        "Replace hardcoded yq_linux_amd64 with architecture-aware download using TARGETARCH",
        "Use TARGETARCH build argument to select correct binary",
        "Dockerfile lint passes (hadolint)",
        "Build succeeds for linux/amd64 target",
        "Build succeeds for linux/arm64 target"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Configure multi-platform builds in workflow",
      "description": "As a developer, I want the container built for both AMD64 and ARM64 architectures so that it runs natively on Intel/AMD and Apple Silicon machines.",
      "acceptanceCriteria": [
        "Use docker/setup-qemu-action for cross-platform emulation",
        "Use docker/setup-buildx-action for BuildKit builder",
        "Build targets both linux/amd64 and linux/arm64 platforms",
        "Single manifest list created containing both architectures",
        "Workflow YAML syntax is valid"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement registry-based build caching",
      "description": "As a developer, I want builds to use GHCR-based caching so that subsequent builds are faster.",
      "acceptanceCriteria": [
        "Configure cache-from with type=registry pointing to cache image",
        "Configure cache-to with type=registry,mode=max for maximum cache layers",
        "Cache image uses separate tag (e.g., buildcache) to avoid polluting release tags",
        "Workflow YAML syntax is valid"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Add security scanning with Trivy",
      "description": "As a developer, I want images scanned for vulnerabilities before push so that we don't publish containers with critical security issues.",
      "acceptanceCriteria": [
        "Use aquasecurity/trivy-action to scan the built image",
        "Scan runs after build but results uploaded to GitHub Security tab",
        "Workflow fails if CRITICAL vulnerabilities are found (exit-code: 1)",
        "Scan results uploaded as SARIF to GitHub Security tab",
        "HIGH vulnerabilities logged as warnings but don't fail the build",
        "Workflow YAML syntax is valid"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Add workflow status badge to README",
      "description": "As a user viewing the repository, I want to see the build status so that I know if the latest image is healthy.",
      "acceptanceCriteria": [
        "Add workflow status badge to README.md at the top",
        "Badge links to the Actions workflow runs",
        "Badge shows current status (passing/failing)",
        "Badge uses correct workflow file path reference"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    }
  ]
}
