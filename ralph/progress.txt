## Codebase Patterns
- Use hadolint via Docker for Dockerfile linting: `docker run --rm -i hadolint/hadolint < Dockerfile`
- Node.js 20 Alpine base image: `node:20-alpine`
- Create non-root user with: `addgroup -g 1000 name && adduser -u 1000 -G name -h /home/name -D name`
- Claude Code npm package: `@anthropic-ai/claude-code` (pin version for hadolint compliance)
- Docker CLI on Alpine: `docker-cli` package (client only, no daemon) - pin version for hadolint
- Validate YAML syntax with: `docker run --rm -v /path:/data mikefarah/yq '.' /data/file.yaml`
- Shellcheck via Docker: `docker run --rm -v /path:/scripts koalaman/shellcheck:stable /scripts/scriptname`
- Use `# shellcheck shell=dash` directive for Alpine shell scripts (dash supports `local` keyword)

---

## 2026-01-18 - US-001
- What was implemented: Base Dockerfile with Alpine Linux, Node.js 20+ LTS, multi-stage build structure, non-root 'claude' user, and /workspace working directory
- Files changed: Dockerfile (created)
- **Learnings for future iterations:**
  - Node.js 20 Alpine image is `node:20-alpine`
  - Multi-stage builds use `AS` alias for stages
  - Alpine uses `addgroup`/`adduser` instead of `groupadd`/`useradd`
  - hadolint returns empty output when Dockerfile passes
---

## 2026-01-18 - US-002
- What was implemented: Added claude-code CLI installation to Docker image via npm global install
- Files changed: Dockerfile (modified)
- **Learnings for future iterations:**
  - The npm package for Claude Code is `@anthropic-ai/claude-code`
  - hadolint requires pinned npm versions (DL3016) - use `package@version` format
  - Clean npm cache with `npm cache clean --force` to reduce image size
  - Check latest npm package version with: `npm view <package> version`
---

## 2026-01-18 - US-003
- What was implemented: Added Docker CLI client to image with DOCKER_HOST environment variable for container communication
- Files changed: Dockerfile (modified)
- **Learnings for future iterations:**
  - Alpine provides `docker-cli` package which contains only the Docker client (no daemon)
  - hadolint DL3018 requires pinning apk package versions: `apk add --no-cache package=version`
  - Check available Alpine package version with: `docker run --rm node:20-alpine apk info <package>`
  - DOCKER_HOST can be set to empty string as default, allowing override at runtime or via docker-compose
---

## 2026-01-18 - US-004
- What was implemented: Created bridge config YAML schema with documented example at examples/claude-bridge.yaml
- Files changed: examples/claude-bridge.yaml (created)
- **Learnings for future iterations:**
  - Bridge config schema supports: version, default_container, containers (name overrides), commands (with container, exec, workdir)
  - Use yq via Docker for YAML validation: `docker run --rm -v /path:/data mikefarah/yq '.' /data/file.yaml`
  - Example files should be well-commented to serve as both documentation and working templates
  - YAML keys with special characters like colons need quoting: `"test:php"`
---

## 2026-01-18 - US-005
- What was implemented: Created bridge shell script with YAML config parsing using yq, including error handling for missing or invalid config files
- Files changed: scripts/bridge (created)
- **Learnings for future iterations:**
  - Use `# shellcheck shell=dash` directive to tell shellcheck that the script targets dash/ash (which supports `local`)
  - Alpine's sh is actually BusyBox ash which supports `local` keyword unlike strict POSIX sh
  - Shellcheck via Docker: `docker run --rm -v /path:/scripts koalaman/shellcheck:stable /scripts/scriptname`
  - Bridge script uses BRIDGE_CONFIG env var to allow config path override (defaults to /workspace/.claude/bridge.yaml)
  - yq queries: `.version // ""` provides default value if key missing, `.key | type` checks if key exists
---

## 2026-01-18 - US-006
- What was implemented: Added command routing functionality to the bridge script including command lookup, container name resolution, docker exec command building, and argument passthrough
- Files changed: scripts/bridge (modified)
- **Learnings for future iterations:**
  - yq bracket notation for quoted keys: `.commands["test:php"]` to access keys with special characters
  - Global variables (CMD_CONTAINER, CMD_EXEC, CMD_WORKDIR) work well for passing data between functions in shell scripts
  - Use `shift` to separate first argument from remaining ones for cleaner argument handling
  - `# shellcheck disable=SC2086` allows word splitting when intentional (for building command strings)
  - Default container fallback requires checking both empty string and "null" (yq returns "null" for missing keys)
---

## 2026-01-18 - US-007
- What was implemented: Added real-time output streaming with TTY allocation (-t flag) and exit code propagation to the bridge script
- Files changed: scripts/bridge (modified)
- **Learnings for future iterations:**
  - Use `[ -t 1 ]` to check if STDOUT is connected to a terminal before allocating TTY
  - TTY allocation (`docker exec -t`) enables real-time unbuffered output streaming
  - Exit codes automatically propagate when the docker exec command is the last command in the function/script
  - STDOUT and STDERR stream directly through docker exec without needing special handling
  - Document output behavior in the usage/help section for user awareness
---
