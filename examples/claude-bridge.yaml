# Claude Bridge Configuration Schema
# ==================================
# This file documents the YAML schema for configuring the claude-bridge
# command routing system. Place your config at /workspace/.claude/bridge.yaml
#
# The bridge script uses this config to route commands from the Claude
# container to the appropriate sidecar containers via Docker socket.

# Schema version (required)
# Currently supports: "1"
version: "1"

# Default container for unrecognized commands (optional)
# If a command doesn't match any entry in 'commands', it will be
# executed in this container. If not specified, unrecognized commands
# will fail with an error.
default_container: app

# Container name overrides (optional)
# Maps logical container names to actual container names.
# Useful when container names include project prefixes or suffixes.
# Example: If your PHP container is named "myproject_php_1", map it here.
containers:
  app: myproject-app-1
  php: myproject-php-1
  node: myproject-node-1
  db: myproject-db-1

# Command mappings (required)
# Maps command aliases to their container and execution details.
# Each command entry supports:
#   - container: (required) Logical container name (resolved via 'containers' section)
#   - exec: (required) The actual command to execute in the container
#   - workdir: (optional) Working directory inside the container
#   - paths: (optional) Path mappings for translating file paths (see below)
#
# Path Mapping (Optional):
# ========================
# When Claude's workspace path differs from the container's working directory,
# use 'paths' to translate file paths in command arguments. This is needed when:
#   - Claude sees files at /workspace/src/file.php
#   - But the container expects them at /var/www/html/src/file.php
#
# The bridge translates paths in arguments automatically using longest-prefix matching.
# Example: /workspace/app/User.php → /var/www/html/app/User.php
#
commands:
  # PHP/Laravel commands
  # These commands use path mapping because:
  #   - Claude's workspace is mounted at /workspace
  #   - PHP container's document root is /var/www/html
  #   - When Claude references /workspace/app/User.php, the PHP container
  #     needs /var/www/html/app/User.php
  php:
    container: php
    exec: php
    workdir: /var/www/html
    paths:
      /workspace: /var/www/html

  composer:
    container: php
    exec: composer
    workdir: /var/www/html
    paths:
      /workspace: /var/www/html

  artisan:
    container: php
    exec: php artisan
    workdir: /var/www/html
    paths:
      /workspace: /var/www/html

  "test:php":
    container: php
    exec: php artisan test
    workdir: /var/www/html
    paths:
      /workspace: /var/www/html

  phpunit:
    container: php
    exec: ./vendor/bin/phpunit
    workdir: /var/www/html
    paths:
      /workspace: /var/www/html

  # Node.js commands
  # These use /workspace → /app mapping (common for Node containers)
  node:
    container: node
    exec: node
    workdir: /app
    paths:
      /workspace: /app

  npm:
    container: node
    exec: npm
    workdir: /app
    paths:
      /workspace: /app

  npx:
    container: node
    exec: npx
    workdir: /app
    paths:
      /workspace: /app

  "test:js":
    container: node
    exec: npm test
    workdir: /app
    paths:
      /workspace: /app

  # Database commands
  mysql:
    container: db
    exec: mysql

  psql:
    container: db
    exec: psql

# Usage Examples:
# ==============
# After configuring this file, use the bridge command:
#
#   bridge php -v                     # Run 'php -v' in php container
#   bridge artisan migrate            # Run 'php artisan migrate'
#   bridge test:php --filter=User     # Run tests with filter
#   bridge npm install                # Install npm packages in node container
#   bridge composer require foo/bar   # Install composer package
#
# Path Mapping Examples:
# ---------------------
# With the paths configuration above, file paths are automatically translated:
#
#   bridge php /workspace/artisan                 # → php /var/www/html/artisan
#   bridge phpunit /workspace/tests/Unit/FooTest.php  # → phpunit /var/www/html/tests/Unit/FooTest.php
#   bridge node /workspace/src/index.js           # → node /app/src/index.js
#
# This lets Claude reference files using /workspace paths while commands
# run with the correct paths inside each container.
#
# Commands are routed to their configured containers and executed via
# 'docker exec' through the socket proxy.
